{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declaration and Submission | AIU</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2C3E50;
            --secondary-color: #1ABC9C;
            --accent-color: #3498DB;
            --dark-color: #1A252F;
            --light-color: #ECF0F1;
            --warning-color: #E74C3C;
            --success-color: #27AE60;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #F5F7FA;
            color: #333;
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            background: var(--primary-color);
            color: white;
            height: 100vh;
            position: sticky;
            top: 0;
            padding: 25px 0;
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
        }
        
        .logo-container {
            text-align: center;
            padding: 0 25px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .logo-container img {
            width: 120px;
            height: auto;
            margin-bottom: 10px;
        }
        
        .logo-container h2 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--light-color);
        }
        
        .nav-menu {
            flex-grow: 1;
            padding: 0 15px;
            overflow-y: auto;
        }
        
        .nav-menu a {
            color: var(--light-color);
            text-decoration: none;
            display: block;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 5px;
            transition: var(--transition);
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .nav-menu a i {
            width: 24px;
            text-align: center;
            margin-right: 10px;
            color: var(--secondary-color);
        }
        
        /* Main Content Styles */
        .main-content {
            padding: 30px;
            background-color: #F5F7FA;
        }
        
        .header {
            margin-bottom: 30px;
            background: white;
            padding: 20px 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .header h1 {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        /* Form Container */
        .form-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }
        
        .form-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        
        .form-header h2 {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .declaration-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: var(--border-radius);
            background-color: #f9f9f9;
        }
        
        .declaration-section h3 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        .declaration-section ul {
            list-style-type: none;
            padding: 0;
            margin-bottom: 25px;
        }
        
        .declaration-section ul li {
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
            line-height: 1.6;
        }
        
        .declaration-section ul li::before {
            content: "•";
            color: var(--secondary-color);
            font-size: 1.5em;
            position: absolute;
            left: 0;
            top: -2px;
        }
        
        .agree-checkbox {
            margin: 25px 0;
            display: flex;
            align-items: center;
        }
        
        .agree-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
        }
        
        .agree-checkbox label {
            font-weight: 500;
            color: var(--primary-color);
        }
        
        .submit-note {
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(26, 188, 156, 0.1);
            border-left: 4px solid var(--secondary-color);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
        }
        
        .submit-note strong {
            color: var(--secondary-color);
        }
        
        .error-message {
            color: var(--warning-color);
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
            display: none;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 15px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
        }
        
        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #16A085;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(26, 188, 156, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--secondary-color);
            color: var(--secondary-color);
        }
        
        .btn-outline:hover {
            background: rgba(26, 188, 156, 0.1);
        }
        
        .sidebar-footer {
            padding: 15px 25px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
         /* Notification Styles */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }

        .notification {
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease-out;
            box-shadow: var(--box-shadow);
        }

        .notification.success {
            background-color: var(--success-color);
        }

        .notification.error {
            background-color: var(--warning-color);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Responsive Adjustments */
        @media (max-width: 992px) {
            body {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                height: auto;
                position: relative;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="logo-container">
            <img src="{% static 'images/logo.jpg' %}" alt="AIU Logo">
            <h2>Albukhary International University</h2>
        </div>
        
        <div class="nav-menu">
            <a href="{% url 'dashboard' %}">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="{% url 'program_selection' %}">
                <i class="fas fa-list-ol"></i> Program Selection
            </a>
            <a href="{% url 'basic_info' %}">
                <i class="fas fa-user-graduate"></i> Student Profile
            </a>
            <a href="{% url 'academic_info' %}">
                <i class="fas fa-book-open"></i> Academic Info
            </a>
            <a href="{% url 'financial_info' %}">
                <i class="fas fa-wallet"></i> Financial Info
            </a>
            <a href="{% url 'document-uploading' %}">
                <i class="fas fa-cloud-upload-alt"></i> Documents
            </a>
            <a href="{% url 'declaration-submission' %}" class="active">
                <i class="fas fa-check-circle"></i> Declaration
            </a>
            <a href="{% url 'view_status' %}">
                <i class="fas fa-clipboard-list"></i> Application Status
            </a>
            <a href="{% url 'logout' %}">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
        
        <div class="sidebar-footer">
            © 2025 AIU Student Portal | v3.2.1
        </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h1>Declaration and Submission</h1>
        </div>
        
        <!-- Form Container -->
        <div class="form-container">
            <form id="declarationForm" method="POST" action="{% url 'submit_application' %}">
                {% csrf_token %}
                <div class="declaration-section">
                    <h3>Statement of Declaration by Applicant</h3>
                    <ul>
                        <li>I confirm that the information provided in this application form is complete and accurate to the best of my knowledge.</li>
                        <li>I understand that any false or misleading information may result in the rejection of my application or future termination of my enrollment.</li>
                        <li>I have read and understood the Personal Data Protection Policy published on the AIU website and consent to the processing of my personal data as defined in the Data Protection Act 2010.</li>
                        <li>I further understand that I may be required to attend an interview or provide additional documentation as a condition for admission to the program of study for which I have applied.</li>
                        <li>I confirm that I have never been convicted of any criminal offense in any jurisdiction.</li>
                        <li>I understand that all decisions regarding my eligibility for admission are final and at the sole discretion of AIU.</li>
                    </ul>

                    <div class="agree-checkbox">
                        <input type="checkbox" name="agree_to_terms" id="agreeCheckbox" required>
                        <label for="agreeCheckbox">
                            I agree to the above declaration and confirm that all information provided is true and accurate.
                        </label>
                    </div>

                    <div class="submit-note">
                        <strong>Note:</strong> Once you submit your application, you will not be able to make any changes. Please review your information carefully before proceeding.
                    </div>

                    <div id="errorMessage" class="error-message"></div>

                    <div class="action-buttons">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Submit Application
                        </button>
                        <a href="{% url 'document-uploading' %}" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i> Back to Documents
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
  {% if messages %}
    <div class="notification-container">
        {% for message in messages %}
        <div class="notification {% if message.tags %}{{ message.tags }}{% endif %}">
            <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %}"></i>
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <script>
     document.getElementById('declarationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const checkbox = document.getElementById('agreeCheckbox');
    const errorElement = document.getElementById('errorMessage');
    const submitBtn = document.getElementById('submitBtn');
    
    // Check if the checkbox is checked
    if (!checkbox.checked) {
        errorElement.textContent = 'You must agree to the declaration before submitting your application.';
        errorElement.style.display = 'block';
        return;
    }
    
    // Confirmation prompt before submitting
    if (!confirm('Are you sure you want to submit your application? You will not be able to make changes after submission.')) {
        return;
    }
    
    // Disable button to prevent double submission
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
    
    // Send form data via AJAX
    fetch("{% url 'submit_application' %}", {
        method: 'POST',
        body: new FormData(this),
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        // Handle response
        if (data.success) {
            showNotification(data.message, 'success');
            if (data.redirect_url) {
                setTimeout(() => {
                    window.location.href = data.redirect_url;
                }, 2000);
            }
        } else {
            showNotification(data.message, 'error');
        }

        // Re-enable the submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Submit Application';
    })
    .catch(error => {
        // Handle network or other errors
        showNotification('An error occurred. Please try again later.', 'error');

        // Re-enable the submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Submit Application';
    });
});

// Helper function to show notifications
function showNotification(message, type = 'success') {
    let notificationContainer = document.querySelector('.notification-container');
    if (!notificationContainer) {
        notificationContainer = document.createElement('div');
        notificationContainer.className = 'notification-container';
        document.body.appendChild(notificationContainer);
    }

    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
        ${message}
    `;
    notificationContainer.appendChild(notification);

    setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease-out';
    }, 10);

    setTimeout(() => {
        notification.style.animation = 'fadeOut 0.5s ease';
        setTimeout(() => notification.remove(), 500);
    }, 5000);
}
    </script>
</body>
</html>